kind: pipeline
name: default

steps:
- name: build
  image: python:3.6-alpine
  commands:
      - apk update && apk add zip
      - pip install -r requirements.txt -t .
      - zip -r -9 transaction-${DRONE_BUILD_NUMBER}.zip *
  s3-publish:
    image: plugins/s3
    settings:
      access_key: AKIA3B4U6ZRO63IEEKZB
      secret_key: 
        from_secret: p_aws
    acl: private
    region: us-west-2
    bucket: tkharness
    source: transaction-${DRONE_BUILD_NUMBER}.zip
  when:
    event:
    - push
